# Docker service 

## Docker Swarm Service - force update of latest image already running

### No1:  You could use image ID instead of username/imagename:latest like this:

```shell
docker service update --image \$(docker inspect --type image --format '{{.Id}}' username/imagename:latest) \servicename

#docker inspect --type image --format '{{.Id}}' nginx:1.17
sha256:9beeba249f3ee158d3e495a6ac25c5667ae2de8a43ac2a8bfd2bf687a58c06c9

```
But in this case all your nodes must pull this image before service update. Otherwise, containers will be updated only on those nodes where image with such ID exists. Fortunately, nodes which do not have this image will stop their containers, so there is nothing bad if some nodes will fail to pull new version of image.

> UPDATE: or you could use image digest as follow:

```shell
docker service update --image \$(docker inspect --type image --format '{{index .RepoDigests 0}}' username/imagename:latest) \servicename

#docker inspect --type image --format '{{index .RepoDigests 0}}' nginx:1.17
nginx@sha256:6fff55753e3b34e36e24e37039ee9eae1fe38a6420d8ae16ef37c92d1eb26699

```
docker inspect --type image --format '{{index .RepoDigests 0}}' IMAGE returns image digest which includes unique hash of image generated by registry v2. Thus, image must be pulled from registry, otherwise digest will not be available.

Using digest allow you do not pull images on all of your nodes (images with specified digest will automatically be pulled from regiistry on necessary nodes). But you have to pull fresh version of image once on a manager node before service update.

```shell

```

### No2: mathod

Docker won't automatically perform a pull from DockerHub (or private registry) for an image:tag you already have locally.

If you performed a manual pull before the docker service update, or deleted the image locally, it would.

You could also chain the command:

```shell
docker pull image:tag && docker service update --image username/imagename:latest servicename

```
### No3: docker service update --force service_name

Docker 1.13 added a --force flag to service update:

--force: Force update even if no changes require it

Use it as in:

```shell
docker service update --force service_name
```


